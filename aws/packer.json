{
  "variables": {
    "aws_access_key": null,
    "aws_secret_key": null,
    "deps_url": null,
    "agent_url": null,
    "ami_name": null,

    "vpc_id_us_east_1": null,
    "subnet_id_us_east_1": null,
    "base_ami_id_us_east_1": null,

    "vpc_id_us_west_2": null,
    "subnet_id_us_west_2": null,
    "base_ami_id_us_west_2": null
  },
  "builders": [
    {
      "name": "amazon-ebs-us-east-1",
      "type": "amazon-ebs",
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "region": "us-east-1",
      "source_ami": "{{user `base_ami_id_us_east_1`}}",
      "instance_type": "m3.xlarge",
      "ami_name": "{{user `ami_name`}}-us-east-1",
      "vpc_id": "{{user `vpc_id_us_east_1`}}",
      "subnet_id": "{{user `subnet_id_us_east_1`}}",
      "associate_public_ip_address": true,
      "communicator": "winrm",
      "winrm_username": "Administrator",
      "user_data_file": "setup_winrm.txt",
      "ami_groups": "all"
    },
    {
      "name": "amazon-ebs-us-west-2",
      "type": "amazon-ebs",
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "region": "us-west-2",
      "source_ami": "{{user `base_ami_id_us_west_2`}}",
      "instance_type": "m3.xlarge",
      "ami_name": "{{user `ami_name`}}-us-west-2",
      "vpc_id": "{{user `vpc_id_us_west_2`}}",
      "subnet_id": "{{user `subnet_id_us_west_2`}}",
      "associate_public_ip_address": true,
      "communicator": "winrm",
      "winrm_username": "Administrator",
      "user_data_file": "setup_winrm.txt",
      "ami_groups": "all"
    }
  ],

  "provisioners": [
      {
          "type": "powershell",
          "scripts": [
            "../scripts/setup_agent.ps1",
            "scripts/agent_config.ps1",
            "scripts/ec2-set-password.ps1"
          ],
          "environment_vars": [
            "AGENT_DEPS_ZIP_URL={{user `deps_url`}}",
            "AGENT_ZIP_URL={{user `agent_url`}}"
          ]
      }
  ]
}
